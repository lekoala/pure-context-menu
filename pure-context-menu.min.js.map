{
  "version": 3,
  "sources": ["pure-context-menu.js"],
  "sourcesContent": ["/**\n * @typedef Config\n * @property {String} contextMenuClass Class applied for holder element\n * @property {String} dropdownClass Class applied for dropdown. Accepts space separated classes\n * @property {String} dividerClass Class applied to the divider item\n * @property {String} menuItemClass Class applied to the li in all cases.\n * @property {String} itemClass Class applied to the menu item. Accepts space separated classes\n * @property {String} disabledClass Class applied to the disabled items\n * @property {Number} zIndex z-index assigned to the menu\n * @property {Boolean} preventCloseOnClick Global behaviour for items when clicking\n * @property {Boolean} useLists Enable list groups\n * @property {String} listClass Class applied to the list\n * @property {String} listItemClass Class applied to the list item. Accepts space separated classes\n * @property {Boolean} fastClick Triggers click on touchstart for mobile devices\n * @property {Boolean} closeIfOpen Close menu with right close if already opened\n * @property {Function} show Whether to show menu based on event\n */\nlet baseOptions = {\n  contextMenuClass: \"pure-context-menu\",\n  dropdownClass: \"dropdown-menu\",\n  dividerClass: \"dropdown-divider\",\n  menuItemClass: \"pure-context-menu-item\",\n  itemClass: \"dropdown-item pure-context-menu-item\",\n  disabledClass: [\"disabled\", \"user-select-none\"],\n  zIndex: \"9999\",\n  preventCloseOnClick: false,\n  useLists: false,\n  listClass: \"list-group\",\n  listItemClass: \"list-group-item list-group-item-action\",\n  fastClick: false,\n  closeIfOpen: false,\n  show: (event, inst) => true,\n};\n\nlet instances = new Set();\n\n/**\n * @typedef Item\n * @property {String} label\n * @property {Boolean} [html]\n * @property {Array} [classes]\n * @property {Boolean} [preventCloseOnClick]\n * @property {Boolean} [disabled]\n * @property {Function} [callback]\n */\n\n/**\n * Easily manage context menus\n * Works out of the box with bootstrap css\n */\nclass PureContextMenu {\n  _el;\n  _contextMenu;\n  _items;\n  _options;\n  _currentEvent;\n\n  /**\n   * @param {HTMLElement} el\n   * @param {object} items\n   * @param {object} opts\n   */\n  constructor(el, items, opts) {\n    /**\n     * @type {Item[]}\n     */\n    this._items = items;\n\n    /**\n     * @type {HTMLElement}\n     */\n    this._el = el;\n\n    /**\n     * @type {HTMLElement}\n     */\n    this._contextMenu = null;\n\n    /**\n     * @type {Config}\n     */\n    this._options = Object.assign({}, baseOptions, opts);\n\n    // bind the menu on context menu\n    // add also long press support, this helps with ios browsers\n    // include https://cdn.jsdelivr.net/npm/long-press-event@2.4/dist/long-press-event.min.js in your pages\n    [\"contextmenu\", \"long-press\", \"keydown\"].forEach((type) => {\n      el.addEventListener(type, this);\n    });\n\n    // close if the user clicks outside of the menu\n    this._clickEvents().forEach((type) => {\n      document.addEventListener(type, this);\n    });\n\n    instances.add(this);\n  }\n\n  _clickEvents() {\n    if (this._options.fastClick) {\n      return [\"click\", \"touchstart\"];\n    }\n    return [\"click\"];\n  }\n\n  /**\n   * @link https://gist.github.com/WebReflection/ec9f6687842aa385477c4afca625bbf4#handling-events\n   * @param {Event} event\n   */\n  handleEvent = (event) => {\n    const aliases = {\n      \"long-press\": \"contextmenu\",\n      touchstart: \"click\",\n    };\n    const type = aliases[event.type] || event.type;\n    this[`on${type}`](event);\n  };\n\n  /**\n   * @param {Config} opts\n   */\n  static updateDefaultOptions(opts) {\n    baseOptions = Object.assign(baseOptions, opts);\n  }\n\n  /**\n   * @returns {Config}\n   */\n  static getDefaultOptions() {\n    return baseOptions;\n  }\n\n  /**\n   * @returns {Item[]}\n   */\n  getItems() {\n    return this._items;\n  }\n\n  /**\n   * @param {Item[]} items\n   */\n  setItems(items) {\n    this._items = items;\n  }\n\n  /**\n   * Create the menu\n   * @returns {HTMLElement}\n   */\n  _buildContextMenu = () => {\n    const useLists = this._options.useLists;\n    const contextMenu = document.createElement(\"ul\");\n    contextMenu.style.minWidth = \"120px\";\n    contextMenu.style.maxWidth = \"240px\";\n    contextMenu.style.display = \"block\";\n    contextMenu.classList.add(this._options.contextMenuClass);\n    contextMenu.classList.add(...this._options.dropdownClass.split(\" \"));\n    if (useLists) {\n      contextMenu.classList.add(this._options.listClass);\n    }\n\n    for (const item of this._items) {\n      const child = document.createElement(\"li\");\n      child.classList.add(this._options.menuItemClass);\n\n      // With lists, classes are applied on li\n      if (useLists) {\n        //@link https://getbootstrap.com/docs/5.3/components/list-group/#for-links-and-buttons\n        child.classList.add(...this._options.listItemClass.split(\" \"));\n        if (item.disabled) {\n          child.classList.add(...this._options.disabledClass);\n        }\n      }\n      if (item.classes) {\n        child.classList.add(...item.classes);\n      }\n      if (item === \"-\") {\n        const divider = document.createElement(\"hr\");\n        divider.classList.add(this._options.dividerClass);\n        child.appendChild(divider);\n      } else {\n        const link = document.createElement(\"a\");\n        if (item.html) {\n          link.innerHTML = item.label;\n        } else {\n          link.innerText = item.label;\n        }\n        link.style.cursor = \"pointer\";\n        link.style.whiteSpace = \"normal\";\n\n        // Without lists, classes are applied on child item\n        if (!useLists) {\n          link.classList.add(...this._options.itemClass.split(\" \"));\n          if (item.disabled) {\n            link.classList.add(...this._options.disabledClass);\n          }\n        }\n        child.appendChild(link);\n      }\n      contextMenu.appendChild(child);\n    }\n    return contextMenu;\n  };\n\n  /**\n   * Normalize the context menu position so that it won't get out of bounds\n   * @param {number} mouseX\n   * @param {number} mouseY\n   * @param {HTMLElement} contextMenu\n   */\n  _normalizePosition = (mouseX, mouseY, contextMenu) => {\n    const scope = this._el;\n    const contextStyles = window.getComputedStyle(contextMenu);\n    // clientWidth exclude borders and we add 1px for good measure\n    const offset = parseInt(contextStyles.borderWidth) + 1;\n\n    // compute what is the mouse position relative to the container element (scope)\n    const bounds = scope.getBoundingClientRect();\n\n    let scopeX = mouseX;\n    let scopeY = mouseY;\n\n    if (![\"BODY\", \"HTML\"].includes(scope.tagName)) {\n      scopeX -= bounds.left;\n      scopeY -= bounds.top;\n    }\n\n    const menuWidth = parseInt(contextStyles.width);\n\n    // check if the element will go out of bounds\n    const outOfBoundsOnX = scopeX + menuWidth > scope.clientWidth;\n    const outOfBoundsOnY = scopeY + contextMenu.clientHeight > scope.clientHeight;\n\n    let normalizedX = mouseX;\n    let normalizedY = mouseY;\n\n    // normalize on X\n    if (outOfBoundsOnX) {\n      normalizedX = scope.clientWidth - menuWidth - offset;\n      if (![\"BODY\", \"HTML\"].includes(scope.tagName)) {\n        normalizedX += bounds.left;\n      }\n    }\n\n    // normalize on Y\n    if (outOfBoundsOnY) {\n      normalizedY = scope.clientHeight - contextMenu.clientHeight - offset;\n      if (![\"BODY\", \"HTML\"].includes(scope.tagName)) {\n        normalizedY += bounds.top;\n      }\n    }\n\n    return { normalizedX, normalizedY };\n  };\n\n  /**\n   * @returns {Boolean}\n   */\n  close = () => {\n    if (this._contextMenu) {\n      this._contextMenu.remove();\n      this._contextMenu = null;\n      return true;\n    }\n    return false;\n  };\n\n  /**\n   * keypress doesn't send arrow keys, so we use keydown\n   * @param {KeyboardEvent} event\n   */\n  onkeydown(event) {\n    let key = event.keyCode || event.key;\n\n    switch (key) {\n      case 27:\n      case \"Escape\":\n        this.close();\n        break;\n    }\n  }\n\n  /**\n   * @param {MouseEvent} event\n   */\n  oncontextmenu = (event) => {\n    if (!this._options.show(event, this)) {\n      return;\n    }\n\n    // Block regular context menu if our menu is shown\n    event.preventDefault();\n    event.stopPropagation();\n\n    // Close existing menus\n    let closed = false;\n    instances.forEach((inst) => {\n      const wasClosed = inst.close();\n      if (wasClosed && inst === this) {\n        closed = true;\n      }\n    });\n\n    // Don't open again if option is set\n    if (this._options.closeIfOpen && closed) {\n      return;\n    }\n\n    // Don't do anything if clicked on the same menu\n    const closestMenu = event.target.closest(`.${this._options.contextMenuClass}`);\n    if (closestMenu) {\n      return;\n    }\n\n    // Store event for callbacks, this allows to know what is the target that triggered the menu\n    this._currentEvent = event;\n\n    // the current context menu should disappear when a new one is displayed\n    this.close();\n\n    // build and show on ui\n    const contextMenu = this._buildContextMenu();\n    document.querySelector(\"body\").append(contextMenu);\n\n    // set the position already so that width can be computed\n    contextMenu.style.position = \"fixed\";\n    contextMenu.style.zIndex = this._options.zIndex;\n\n    // adjust the position according to mouse position\n    const mouseX = event.detail.clientX ?? event.clientX;\n    const mouseY = event.detail.clientY ?? event.clientY;\n    const { normalizedX, normalizedY } = this._normalizePosition(mouseX, mouseY, contextMenu);\n    contextMenu.style.top = `${normalizedY}px`;\n    contextMenu.style.left = `${normalizedX}px`;\n\n    // Store reference\n    this._contextMenu = contextMenu;\n  };\n\n  /**\n   * @param {MouseEvent} event\n   */\n  _isCurrentTarget = (event) => {\n    const closestMenu = event.target.closest(`.${this._options.contextMenuClass}`);\n    if (closestMenu == this._contextMenu && this._contextMenu) {\n      return true;\n    }\n    return false;\n  };\n\n  /**\n   * @param {MouseEvent} event\n   */\n  _handleItemClick = (event) => {\n    const t = event.target;\n    /**\n     * @type {HTMLLIElement}\n     */\n    const li = t.closest(`li`);\n    if (li) {\n      const index = [...li.parentElement.childNodes].findIndex((item) => item === li);\n      const item = this._items[index];\n\n      if (item.callback && !item.disabled) {\n        item.callback(this._currentEvent, this);\n\n        // do not close the menu if set\n        const preventCloseOnClick = item.preventCloseOnClick ?? this._options.preventCloseOnClick ?? false;\n        if (!preventCloseOnClick) {\n          this.close();\n        }\n      }\n    }\n  };\n\n  /**\n   * Used to determine if the user has clicked outside of the context menu and if so, close it\n   * Handles delegated events on menu items\n   * @param {MouseEvent} event\n   */\n  onclick = (event) => {\n    if (this._isCurrentTarget(event)) {\n      this._handleItemClick(event);\n      return;\n    }\n    this.close();\n  };\n\n  /**\n   * Remove all the event listeners that were registered for this feature\n   */\n  off = () => {\n    instances.delete(this);\n    this.close();\n    this._clickEvents().forEach((type) => {\n      document.removeEventListener(type, this);\n    });\n    [\"contextmenu\", \"long-press\", \"keydown\"].forEach((type) => {\n      this._el.removeEventListener(type, this);\n    });\n  };\n}\n\nexport default PureContextMenu;\n"],
  "mappings": "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",
  "names": ["baseOptions", "event", "inst", "instances", "PureContextMenu", "_el", "_contextMenu", "_items", "_options", "_currentEvent", "el", "items", "opts", "type", "_clickEvents", "_buildContextMenu", "useLists", "contextMenu", "item", "child", "divider", "link", "_normalizePosition", "mouseX", "mouseY", "scope", "contextStyles", "offset", "bounds", "scopeX", "scopeY", "menuWidth", "outOfBoundsOnX", "outOfBoundsOnY", "normalizedX", "normalizedY", "closed", "_isCurrentTarget", "_handleItemClick", "li", "index", "pure_context_menu_default"]
}
